package game;

public class Duel {
    private final Player player1;
    private final Player player2;

    private Gesture gesture1;
    private Gesture gesture2;

    // callback po zarejestrowaniu obu gestów
    private Runnable onEnd;

    public Duel(Player player1, Player player2) {
        this.player1 = player1;
        this.player2 = player2;
        this.player1.enterDuel(this);
        this.player2.enterDuel(this);
    }

    public void setOnEnd(Runnable onEnd) { this.onEnd = onEnd; }

    public record Result(Player winner, Player loser) {}

    public Result evaluate() {
        if (gesture1 == null || gesture2 == null) return null;
        int cmp = gesture1.compareWith(gesture2);
        if (cmp == 0) return null;

        Result res = (cmp > 0) ? new Result(player1, player2) : new Result(player2, player1);

        // pojedynek zakończony — gracze wychodzą
        player1.leaveDuel();
        player2.leaveDuel();

        return res;
    }

    public void handleGesture(Player player, Gesture gesture) {
        if (player == player1) {
            gesture1 = gesture;
        } else if (player == player2) {
            gesture2 = gesture;
        }
        if (gesture1 != null && gesture2 != null && onEnd != null) {
            onEnd.run();
        }
    }
}
